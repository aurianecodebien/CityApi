apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  name: city-api-prod-db
  labels:
    app: city-api-app
    environment: prod
spec:
  databaseReclaimPolicy: retain
  name: city_api-prod-pg
  cluster:
    name: city-api-pg
  owner: city_api
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cnpg-manager-role
  namespace: cityapi
rules:
  - apiGroups: [""]
    resources: ["secrets", "configmaps", "pods", "services", "persistentvolumeclaims", "events"]
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cnpg-manager-rolebinding
  namespace: cityapi
subjects:
  - kind: ServiceAccount
    name: cnpg-manager
    namespace: cityapi
roleRef:
  kind: Role
  name: cnpg-manager-role
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cnpg-controller-manager-config
  namespace: cnpg-system
data:
  INHERITED_ANNOTATIONS: categories
  INHERITED_LABELS: environment, workload, app
  ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES: 'true'
---
apiVersion: v1
kind: Secret
metadata:
  name: cnpg-controller-manager-config
  namespace: cnpg-system
type: Opaque
data:
  CNPG_PASSWORD: eW91ci1wYXNzd29yZA==

